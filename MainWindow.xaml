<Window x:Class="YiboFile.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:YiboFile"
        xmlns:controls="clr-namespace:YiboFile.Controls"
        Title="YiboFile - æ–‡ä»¶èµ„æºç®¡ç†å™¨" 
        Height="800" 
        Width="1200"
        MinHeight="600"
        MinWidth="960"
        WindowState="Normal"
        WindowStyle="SingleBorderWindow"
        AllowsTransparency="False"
        ResizeMode="CanResize"
        UseLayoutRounding="True"
        Background="{DynamicResource AppBackgroundBrush}"
        PreviewKeyDown="MainWindow_PreviewKeyDown"
        Closing="Window_Closing"
        LocationChanged="Window_LocationChanged">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="50" 
                      ResizeBorderThickness="4" 
                      GlassFrameThickness="1" 
                      CornerRadius="0" 
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <local:TimeUnitConverter x:Key="TimeUnitConverter"/>
    </Window.Resources>
    
    <!-- ä¸»å®¹å™¨ï¼šåŒ…å«æ ‡é¢˜æ å’Œçª—å£å†…å®¹ -->
    <Grid Name="MainContainer">
        <!-- çª—å£å†…å®¹å®¹å™¨ -->
    <Grid Name="RootGrid" Background="{DynamicResource AppBackgroundBrush}">
        <Grid.Style>
            <Style TargetType="Grid">
                <Setter Property="Margin" Value="4"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding WindowState, RelativeSource={RelativeSource AncestorType=Window}}" Value="Maximized">
                        <Setter Property="Margin" Value="8"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>
        <!-- å·¦ä¸­å³3åˆ—å¸ƒå±€ -->
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="ColLeft" Width="220" MinWidth="220"/>
            <ColumnDefinition Width="12"/>
            <ColumnDefinition x:Name="ColCenter" Width="*" MinWidth="250"/>
            <ColumnDefinition Width="12"/>
            <ColumnDefinition x:Name="ColRight" Width="360" MinWidth="360"/>
        </Grid.ColumnDefinitions>
        
        <!-- å¸ƒå±€ï¼šæ ‡é¢˜æ è¡Œ + æ ‡ç­¾é¡µè¡Œ + å†…å®¹è¡Œ -->
        <Grid.RowDefinitions>
            <RowDefinition Height="51"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- æ ‡é¢˜æ èƒŒæ™¯ï¼ˆåŒ…å«åº•éƒ¨è¾¹æ¡†ï¼‰ -->
        <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="5"
                Background="Transparent"
                BorderBrush="{DynamicResource BorderSubtleBrush}"
                BorderThickness="0,0,0,1"
                Panel.ZIndex="1000"/>
        
        <!-- å¯¼èˆªæŒ‰é’®ï¼šä½äºŽåˆ—0 (éšåˆ—0å®½åº¦è‡ªåŠ¨è°ƒæ•´) -->
        <Grid Name="NavButtonsContainer" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0" Panel.ZIndex="1001">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- å¯¼èˆªæŒ‰é’®åŒºåŸŸï¼šå›ºå®šå®½åº¦ï¼Œå·¦å¯¹é½ -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="8,0" WindowChrome.IsHitTestVisibleInChrome="True">
                <Button Name="NavPathBtn" Click="NavPathBtn_Click" Margin="2,0" Height="32" Width="60"
                        Tag="Selected"> <!-- é»˜è®¤é€‰ä¸­è·¯å¾„ -->
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Height" Value="36"/>
                            <Setter Property="Margin" Value="2,0"/>
                            <Setter Property="Padding" Value="8,0"/>
                            <Setter Property="Cursor" Value="Hand"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border"
                                                Background="{TemplateBinding Background}" 
                                                BorderBrush="{DynamicResource AccentBrush}" 
                                                BorderThickness="0"
                                                CornerRadius="4,4,0,0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="{DynamicResource ButtonHoverBackgroundBrush}"/>
                                            </Trigger>
                                            <Trigger Property="Tag" Value="Selected">
                                                 <Setter TargetName="border" Property="BorderThickness" Value="0,0,0,2"/>
                                                 <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}"/>
                                                 <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                 <Setter Property="FontWeight" Value="SemiBold"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="{DynamicResource Icon_Nav_Path}" FontFamily="{DynamicResource IconFontFamily}" Margin="0,0,6,0" VerticalAlignment="Center"/>
                        <TextBlock Text="è·¯å¾„" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <Button Name="NavLibraryBtn" Click="NavLibraryBtn_Click" Margin="2,0" Height="32" Width="60">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Height" Value="36"/>
                            <Setter Property="Margin" Value="2,0"/>
                            <Setter Property="Padding" Value="8,0"/>
                            <Setter Property="Cursor" Value="Hand"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border"
                                                Background="{TemplateBinding Background}" 
                                                BorderBrush="{DynamicResource AccentBrush}" 
                                                BorderThickness="0"
                                                CornerRadius="4,4,0,0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="{DynamicResource ButtonHoverBackgroundBrush}"/>
                                            </Trigger>
                                            <Trigger Property="Tag" Value="Selected">
                                                 <Setter TargetName="border" Property="BorderThickness" Value="0,0,0,2"/>
                                                 <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}"/>
                                                 <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                 <Setter Property="FontWeight" Value="SemiBold"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="{DynamicResource Icon_Nav_Library}" FontFamily="{DynamicResource IconFontFamily}" Margin="0,0,6,0" VerticalAlignment="Center"/>
                        <TextBlock Text="åº“" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- NavTagBtn Phase 2 å°†é‡æ–°å¼•å…¥ -->
                <Button Name="NavTagBtn" Click="NavTagBtn_Click" Margin="2,0" Height="32" Width="60"
                        Tag="Unselected" Visibility="Collapsed">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Height" Value="36"/>
                            <Setter Property="Margin" Value="2,0"/>
                            <Setter Property="Padding" Value="8,0"/>
                            <Setter Property="Cursor" Value="Hand"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border"
                                                Background="{TemplateBinding Background}" 
                                                BorderBrush="{DynamicResource AccentBrush}" 
                                                BorderThickness="0"
                                                CornerRadius="4,4,0,0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="{DynamicResource ButtonHoverBackgroundBrush}"/>
                                            </Trigger>
                                            <Trigger Property="Tag" Value="Selected">
                                                 <Setter TargetName="border" Property="BorderThickness" Value="0,0,0,2"/>
                                                 <Setter Property="Background" Value="{DynamicResource PanelBackgroundBrush}"/>
                                                 <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                                 <Setter Property="FontWeight" Value="SemiBold"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <TextBlock Text="{DynamicResource Icon_Nav_Tag}" FontFamily="{DynamicResource IconFontFamily}" Margin="0,0,6,0" VerticalAlignment="Center"/>
                        <TextBlock Text="æ ‡ç­¾" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </StackPanel>
            
            <!-- åˆ†éš”ç¬¦ (éšè—ä¿ç•™) -->
            <Separator Name="TitleBarSeparator" Visibility="Collapsed" Grid.Column="0" HorizontalAlignment="Right" VerticalAlignment="Center" Height="24" Width="1"/>
        </Grid>

        <!-- æ ‡ç­¾é¡µç®¡ç†å™¨ï¼šä»Žåˆ—1(Splitter)å¼€å§‹ï¼Œè·¨è¶Šå‰©ä½™åˆ— -->
        <controls:TabManagerControl Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="4"
                                    x:Name="TabManager" 
                                    Margin="0,0,380,0"
                                    VerticalAlignment="Center"
                                    Panel.ZIndex="1001"/>



        <!-- ========== æ ‡ç­¾é¡µç®¡ç†å™¨ ========== -->


        <!-- åž‚ç›´åˆ†å‰²å™¨ï¼ˆä»ŽRow 2å¼€å§‹ï¼Œè·¨è¶Š2è¡Œï¼šRow 2å’ŒRow 3ï¼‰ -->
        <!-- å·¦ä¾§å¯¼èˆªä¸Žä¸­é—´æ–‡ä»¶åˆ—è¡¨ä¹‹é—´çš„åˆ†å‰²å™¨ -->
        <controls:CollapsibleGridSplitter x:Name="SplitterLeft" Grid.Row="2" Grid.Column="1" Grid.RowSpan="2"
                      Style="{StaticResource VerticalCollapsibleGridSplitterStyle}"
                      CollapseMode="Previous"
                      ShowsPreview="True"
                      Panel.ZIndex="2000"
                      DragCompleted="GridSplitter_DragCompleted"/>
        
        <!-- ä¸­é—´æ–‡ä»¶åˆ—è¡¨ä¸Žå³ä¾§é¢„è§ˆä¹‹é—´çš„åˆ†å‰²å™¨ -->
        <controls:CollapsibleGridSplitter x:Name="SplitterRight" Grid.Row="2" Grid.Column="3" Grid.RowSpan="2"
                      Style="{StaticResource VerticalCollapsibleGridSplitterStyle}"
                      CollapseMode="Both"
                      ShowsPreview="True"
                      Panel.ZIndex="2000"
                      AutoFillNeighbor="True"
                      DragCompleted="GridSplitter_DragCompleted"/>

        <!-- ========== åˆ—1ï¼šå¯¼èˆªåŒºï¼ˆç‹¬ç«‹æŽ§ä»¶ï¼‰ ========== -->
        <!-- ========== åˆ—1ï¼šå¯¼èˆªåŒºï¼ˆç‹¬ç«‹æŽ§ä»¶ï¼‰ + åº•éƒ¨å…¨å±€æŒ‰é’® ========== -->
        <Grid Grid.Row="2" Grid.Column="0" Grid.RowSpan="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <controls:NavigationPanelControl Grid.Row="0" x:Name="NavigationPanelControl"/>
            
            <!-- åº•éƒ¨å…¨å±€æŒ‰é’®åŒºåŸŸ -->
            <Border Grid.Row="1" Background="{DynamicResource PanelBackgroundBrush}" 
                    BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="0,1,0,0"
                    Padding="4">
                <Grid>
                    <!-- å·¦å¯¹é½ï¼šå¸ƒå±€æ¨¡å¼ -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                        <!-- ä¸“æ³¨æ¨¡å¼ -->
                        <Button x:Name="LayoutFocusBtn" Width="32" Height="32"
                                Content="{DynamicResource Icon_Layout_Focus}"
                                ToolTip="ä¸“æ³¨æ¨¡å¼ (Ctrl+Shift+F)&#x0a;æŠ˜å å·¦å³ï¼Œæœ€å¤§åŒ–æ–‡ä»¶åˆ—è¡¨"
                                Click="LayoutFocus_Click"
                                Background="Transparent" Padding="0" Cursor="Hand"
                                FontSize="14" FontFamily="{DynamicResource IconFontFamily}"
                                Style="{StaticResource ModernButtonStyle}">
                        </Button>
                        
                        <!-- å·¥ä½œæ¨¡å¼ -->
                        <Button x:Name="LayoutWorkBtn" Width="32" Height="32"
                                Content="{DynamicResource Icon_Layout_Work}"
                                ToolTip="å·¥ä½œæ¨¡å¼ (Ctrl+Shift+W)&#x0a;å·¦å¯¼èˆª+æ–‡ä»¶åˆ—è¡¨"
                                Click="LayoutWork_Click"
                                Background="Transparent" Padding="0" Cursor="Hand"
                                FontSize="14" FontFamily="{DynamicResource IconFontFamily}"
                                Style="{StaticResource ModernButtonStyle}">
                        </Button>
                        
                        <!-- å®Œæ•´æ¨¡å¼ -->
                        <Button x:Name="LayoutFullBtn" Width="32" Height="32"
                                Content="{DynamicResource Icon_Layout_Full}"
                                ToolTip="å®Œæ•´æ¨¡å¼ (Ctrl+Shift+A)&#x0a;ä¸‰æ å®Œæ•´å¸ƒå±€"
                                Click="LayoutFull_Click"
                                Background="Transparent" Padding="0" Cursor="Hand"
                                FontSize="14" FontFamily="{DynamicResource IconFontFamily}"
                                Tag="Active"
                                Style="{StaticResource ModernButtonStyle}">
                        </Button>

                        <!-- åŒåˆ—è¡¨æ¨¡å¼ (åˆ†éš”çº¿ + æŒ‰é’®) -->
                        <Border Width="1" Height="16" Background="{DynamicResource BorderSubtleBrush}" Margin="4,0"/>
                        
                        <Button x:Name="DualListToggleBtn" Width="32" Height="32"
                                Content="|  |"
                                ToolTip="åŒåˆ—è¡¨æ¨¡å¼&#x0a;åˆ‡æ¢é¢„è§ˆ/å‰¯æ–‡ä»¶åˆ—è¡¨"
                                Click="DualListToggle_Click"
                                Background="Transparent" Padding="0" Cursor="Hand"
                                FontSize="12" FontWeight="Bold"
                                Style="{StaticResource ModernButtonStyle}">
                        </Button>
                        
                        <!-- å‰ªåˆ‡æ¿åŽ†å² (åˆ†éš”çº¿ + æŒ‰é’®) -->
                        <Border Width="1" Height="16" Background="{DynamicResource BorderSubtleBrush}" Margin="4,0"/>
                        
                        <Button x:Name="ClipboardHistoryBtn" Width="32" Height="32"
                                Content="ðŸ“‹"
                                ToolTip="å‰ªåˆ‡æ¿åŽ†å² (Ctrl+Shift+V)"
                                Click="ClipboardHistoryBtn_Click"
                                Background="Transparent" Padding="0" Cursor="Hand"
                                FontSize="14"
                                Style="{StaticResource ModernButtonStyle}">
                        </Button>
                    </StackPanel>
                    
                    <!-- å³å¯¹é½ï¼šè®¾ç½®/å…³äºŽ -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="TitleBarSettingsButton" Content="{DynamicResource Icon_Window_Settings}" 
                                Width="32" Height="32"
                                Click="Settings_Click" 
                                ToolTip="è®¾ç½®" FontSize="16" FontFamily="{DynamicResource IconFontFamily}"
                                Background="Transparent" Padding="0" Cursor="Hand"
                                Style="{StaticResource ModernButtonStyle}">
                        </Button>
                        
                        <Button x:Name="TitleBarAboutButton" Content="{DynamicResource Icon_Window_About}" 
                                Width="32" Height="32"
                                Click="About_Click" 
                                ToolTip="å…³äºŽ" FontSize="16" FontFamily="{DynamicResource IconFontFamily}"
                                Background="Transparent" Padding="0" Cursor="Hand"
                                Style="{StaticResource ModernButtonStyle}">
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- å‰ªåˆ‡æ¿åŽ†å² Popup -->
            <Popup x:Name="ClipboardHistoryPopup" 
                   PlacementTarget="{Binding ElementName=ClipboardHistoryBtn}"
                   Placement="Top" 
                   StaysOpen="False"
                   AllowsTransparency="True"
                   HorizontalOffset="-100"
                   VerticalOffset="-4">
                <controls:ClipboardHistoryPanel x:Name="ClipboardHistoryPanelControl"/>
            </Popup>
        </Grid>

        <!-- ========== åˆ—2ï¼šæ–‡ä»¶æ˜¾ç¤ºåŒº ========== -->
        <controls:FileBrowserControl x:Name="FileBrowser"
                                     Grid.Column="2" 
                                     Grid.Row="1" 
                                     Grid.RowSpan="3"
                                     HorizontalAlignment="Stretch" 
                                     VerticalAlignment="Stretch"
                                     Margin="0,0,0,0"/>

        <!-- ========== åˆ—3ï¼šå¯åˆ‡æ¢åŒºåŸŸï¼ˆé¢„è§ˆ/å‰¯æ–‡ä»¶åˆ—è¡¨ï¼‰ ========== -->
        <Grid Grid.Row="0" Grid.Column="4" Grid.RowSpan="4" 
              WindowChrome.IsHitTestVisibleInChrome="True"
              Panel.ZIndex="1001">
            <!-- é¢„è§ˆé¢æ¿ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ -->
            <local:RightPanelControl x:Name="RightPanel"
                                     HorizontalAlignment="Stretch"
                                     VerticalAlignment="Stretch"
                                     Visibility="Visible"/>
            
            <!-- å‰¯æ–‡ä»¶åˆ—è¡¨åŒºåŸŸï¼ˆé»˜è®¤éšè—ï¼‰ -->
            <Grid x:Name="SecondFileBrowserContainer" Visibility="Collapsed" 
                  WindowChrome.IsHitTestVisibleInChrome="True">
                <Grid.RowDefinitions>
                    <RowDefinition Height="51"/>  <!-- æ ‡ç­¾é¡µè¡Œ -->
                    <RowDefinition Height="*"/>   <!-- æ–‡ä»¶åˆ—è¡¨ -->
                </Grid.RowDefinitions>
                
                <!-- å‰¯æ ‡ç­¾é¡µç®¡ç†å™¨ -->
                <!-- Margin-Right=430: ä¸ºäº†é¿å¼€å³ä¸Šè§’çš„çª—å£æŽ§åˆ¶æŒ‰é’®åŒºåŸŸ(~422px) -->
                <controls:TabManagerControl x:Name="SecondTabManager" 
                                            Grid.Row="0"
                                            VerticalAlignment="Center"
                                            IsHitTestVisible="True"
                                            WindowChrome.IsHitTestVisibleInChrome="True"/>
                
                <!-- å‰¯æ–‡ä»¶æµè§ˆå™¨ -->
                <controls:FileBrowserControl x:Name="SecondFileBrowser"
                                             Grid.Row="1"
                                             HorizontalAlignment="Stretch" 
                                             VerticalAlignment="Stretch"/>
            </Grid>
        </Grid>

        <!-- è®¾ç½®è¦†ç›–å±‚:è¦†ç›–æ‰€æœ‰å†…å®¹åˆ—,ä¸åŒ…æ‹¬æ ‡é¢˜æ  -->
        <Grid Name="SettingsOverlay"
              Grid.Row="1" Grid.RowSpan="3"
              Grid.Column="0" Grid.ColumnSpan="5"
              Background="{DynamicResource AppBackgroundBrush}"
              Panel.ZIndex="5000"
              Visibility="Collapsed">
            <controls:SettingsPanelControl x:Name="SettingsPanel"/>
        </Grid>

        <!-- å…³äºŽè¦†ç›–å±‚ -->
        <Grid Name="AboutOverlay"
              Grid.Row="1" Grid.RowSpan="3"
              Grid.Column="0" Grid.ColumnSpan="5"
              Background="{DynamicResource AppBackgroundBrush}"
              Panel.ZIndex="5000"
              Visibility="Collapsed">
            <controls:AboutPanelControl x:Name="AboutPanel"/>
        </Grid>
            <!-- å³ä¸Šè§’çª—å£æŽ§åˆ¶æŒ‰é’®ï¼šç§»åŠ¨åˆ° RootGrid å†…éƒ¨ä»¥ä¿æŒ Margin ä¸€è‡´æ€§ -->


        <!-- é€šçŸ¥å®¹å™¨: ä½äºŽåº•éƒ¨ä¸­å¤®ï¼Œè¦†ç›–åœ¨æœ€ä¸Šå±‚ -->
        <StackPanel x:Name="NotificationContainer"
                    Grid.Row="1" Grid.RowSpan="3" Grid.Column="0" Grid.ColumnSpan="5"
                    VerticalAlignment="Bottom" HorizontalAlignment="Center"
                    Margin="0,0,0,20"
                    Panel.ZIndex="9000"/>

        <!-- æ–‡ä»¶æ“ä½œè¿›åº¦å®¹å™¨: ä½äºŽå³ä¸‹è§’ -->
        <Border x:Name="FileOperationProgressContainer"
                Grid.Row="1" Grid.RowSpan="3" Grid.Column="0" Grid.ColumnSpan="5"
                VerticalAlignment="Bottom" HorizontalAlignment="Right"
                Margin="0,0,20,80"
                Panel.ZIndex="8500"
                Visibility="Collapsed"
                Width="380"/>

        <!-- å³ä¸Šè§’çª—å£æŽ§åˆ¶æŒ‰é’®ï¼šæ”¾å›ž RootGrid å†…éƒ¨ä»¥è‡ªåŠ¨é€‚é… Margin -->
        <Grid Name="WindowControlButtonsContainer" 
              Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="5"
              HorizontalAlignment="Right" VerticalAlignment="Top"
              Margin="0,-4,-12,0"
              Height="51"
              Panel.ZIndex="10000"
              PreviewMouseDown="WindowControlButtonsContainer_PreviewMouseDown">
            
            <!-- æŒ‰é’®åŒºåŸŸ -->
            <StackPanel x:Name="WindowButtonsStackPanel" 
                       Orientation="Horizontal"
                       HorizontalAlignment="Right" VerticalAlignment="Stretch"
                       WindowChrome.IsHitTestVisibleInChrome="True">
                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Setter Property="Margin" Value="0,0,0,0"/>
                        <Style.Triggers>
                            <!-- æœ€å¤§åŒ–æ—¶æ·»åŠ å³è¾¹è·ï¼Œé¿å…è´´åˆå±å¹•è¾¹ç¼˜ -->
                            <DataTrigger Binding="{Binding WindowState, RelativeSource={RelativeSource AncestorType=Window}}" Value="Maximized">
                                <Setter Property="Margin" Value="0,0,8,0"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </StackPanel.Style>
                
                <!-- ä¹‹å‰çš„æŒ‰é’®å·²ç§»åŠ¨åˆ°å·¦ä¸‹è§’ -->
                <Grid Width="0" Height="0"/>
                <!-- æœ€å°åŒ–æŒ‰é’® -->
                <Button x:Name="TitleBarMinimizeButton" Content="{DynamicResource Icon_Window_Minimize}" 
                        Width="46"
                        Click="WindowMinimize_Click" 
                        ToolTip="æœ€å°åŒ–" FontSize="{DynamicResource WindowControlIconSize}" FontFamily="{DynamicResource IconFontFamily}"
                        Background="Transparent" BorderThickness="0" Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ControlHoverBackgroundBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ControlPressedBackgroundBrush}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <Button x:Name="TitleBarMaxRestoreButton" Content="{DynamicResource Icon_Window_Maximize}" 
                        Width="46"
                        Click="WindowMaximize_Click" 
                        ToolTip="æœ€å¤§åŒ–" FontSize="{DynamicResource WindowControlIconSize}" FontFamily="{DynamicResource IconFontFamily}"
                        Background="Transparent" BorderThickness="0" Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ControlHoverBackgroundBrush}"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource ControlPressedBackgroundBrush}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <!-- å…³é—­æŒ‰é’® -->
                <Button x:Name="TitleBarCloseButton"
                        Width="46"
                        Click="WindowClose_Click" 
                        ToolTip="å…³é—­" Cursor="Hand">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="ButtonBorder" 
                                    Background="Transparent" 
                                    BorderThickness="0">
                                <TextBlock x:Name="ButtonIcon"
                                           Text="{DynamicResource Icon_Window_Close}" 
                                           FontSize="{DynamicResource WindowControlIconSize}" 
                                           FontFamily="{DynamicResource IconFontFamily}"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="ButtonBorder" Property="Background" Value="#E81123"/>
                                    <Setter TargetName="ButtonIcon" Property="Foreground" Value="White"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>
        </Grid>

    </Grid>
        <!-- çŽ°æœ‰çš„å…¶ä»–æŽ§ä»¶ -->

        <!-- ä»»åŠ¡é˜Ÿåˆ—é¢æ¿ (æ‚¬æµ®åœ¨å³ä¸‹è§’) -->
        <controls:TaskQueuePanel x:Name="TaskQueuePanel" 
                              HorizontalAlignment="Right" 
                              VerticalAlignment="Bottom" 
                              Margin="0,0,20,60" 
                              Width="300" Height="250"
                              Visibility="Collapsed"/>
        

    </Grid>
</Window>

