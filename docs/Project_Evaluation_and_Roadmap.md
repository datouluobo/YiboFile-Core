# YiboFile 项目评估与行动计划

> **版本**: v1.0.270 | **更新日期**: 2026-02-01

---

## 一、项目评估

### 1.1 总体评价

**YiboFile** 是一个功能丰富的现代文件管理器，重构 Windows 文件资源管理器的核心体验。本项目目前正处于从传统架构向 **MVVM 架构** 迁移的关键阵痛期。

| 维度 | 评价 |
|------|------|
| ✅ **功能** | 多标签、双栏窗口、标签系统、全文搜索等高级功能 |
| ✅ **UI** | 完整的主题/皮肤系统（目前已实现滚动条和标签美化补丁） |
| ✅ **服务层** | 划分细致，业务逻辑封装意识强 |
| ⚠️ **架构** | 正在稳步实施 MVVM。双面板的逻辑平权已初见成效 |
| ⚠️ **技术债** | `MainWindow` 依然是上帝类，但通过模块化正在逐步瘦身 |

### 1.2 核心问题

| 问题 | 描述 | 状态 |
|------|------|------|
| **God Class** | `MainWindow` 逻辑重度耦合 |  改善中 |
| **VM 状态同步** | 在混合架构期间，ViewModel 与 Code-behind 状态偶尔不同步 | ✅ 本次已修复 |
| **主副面板不平权** | 副面板（右列）在交互细节往往落后于主面板（左列） | ✅ 本次已修复 |
| **绑定错误** | 属性绑定路径与上下文不匹配导致的运行时错误 | ✅ 本次已修复 |

---

## 二、本次更新 (v1.0.270) ✅

### 2.1 双栏面板平权与一致性 (核心改进)
- [x] **选择逻辑对齐**: 针对双栏模式下的副面板（Secondary Panel）进行了逻辑补全，现在它拥有与主面板完全一致的 `HandleNoSelection` 逻辑。
- [x] **信息面板修复**: 当在这个“二等公民”副面板中取消文件选择时，UI 不再会像以前那样粗暴地清空，而是会自动显示当前所在文件夹/标签的详细信息，用户体验与左侧主面板完全一致。
- [x] **架构意义**: 尽管实现上仍有过渡性代码（在 Handler 中复制了部分逻辑），但这标志着我们在用户体验层面上真正实现了双面板的逻辑平权。

### 2.2 绑定与UI逻辑修复
- [x] **MVVM 绑定修复**: 修正了 `MainWindow` 中 `FileBrowserControl` 错误绑定到 `MainWindowViewModel` 的问题，现在正确绑定到对应的 `PaneViewModel` (Primary/Secondary)，解决了 `IsSearching` 和 `SearchStatusText` 的绑定错误。
- [x] **类型转换器**: 引入并正确注册了 `DoubleToGridLengthConverter`，彻底修复了右侧辅助面板 (`RightPanelViewModel`) 中 `NotesHeight` 属性与 UI 之间的绑定崩溃问题。
- [x] **信息面板防清空**: 最初针对主面板的空选逻辑优化，已成功推广到双面板。

### 2.3 地址栏同步修复
- [x] **SSOT (单一数据源) 强化**: 修复了地址栏在从 `tag://` 等虚拟路径导航回普通路径时，UI 未及时更新的问题。

---

## 三、已完成工作 (稳定版)

### 3.1 UI 补丁与细节美化 ✅
- [x] **现代滚动条**: 在 `AppStyles.xaml` 中实现简洁窄化滚动条。
- [x] **标签视觉优化**: 标签列表改为方框容器样式，增强识别度。
- [x] **对话框样式统一**: 采用 `BaseDialogStyle.xaml` 实现扁平化 UI。

### 3.2 服务层优化 ✅
- [x] **文档预览异常捕获**: 增强了 PDF/Office 扫描时的稳定性。
- [x] **窗口状态记忆**: 修正了双屏显示下的窗口位置记忆。
- [x] **Git 历史清理**: 完成了存储库历史的深度清理与优化。

---

## 四、待解决问题与行动计划 (MVVM 深度解耦)

**核心原则**：大方向拆分，小步快跑，每步必测。

### 4.1 方向一：右侧面板 (RightPanelControl) 解耦 ⏳ (当前重点)
**明确定义**：
*   **RightPanelControl**：位于窗口**最右侧**的全局面板。
*   **职能**：仅负责 **文件预览 (上)** 和 **备注信息 (下)**。

| 步骤 | 任务描述 | 验证方法 (可测试性) | 状态 |
|------|----------|-------------------|------|
| **1.1** | **创建 RightPanelViewModel** | 在 `ViewModels` 目录创建类并注册 DI | 检查 DI 容器能否成功解析 | ✅ 已完成 |
| **1.2** | **移除冗余信息区** | 移除旧的文件信息逻辑 | 确认右侧面板只剩预览和备注区 | ✅ 已完成 |
| **1.3** | **UI 绑定与迁移** | 将预览图路径、Webview内容、备注文本绑定到 VM | 实现选中图片预览，选中文件编辑备注 | ✅ 已完成 |
| **1.4** | **清理 MainWindow 后置代码** | 移除旧的 `RightPanel` 操作代码 | 代码清爽，无 UI 直接操作逻辑 | ✅ 已完成 |

---

### 4.2 方向二：全局命令 (Commands) 与菜单重构 🟡
将硬编码的菜单事件迁移为标准 XAML Commands。

| 步骤 | 任务描述 | 验证方法 (可测试性) | 状态 |
|------|----------|-------------------|------|
| **2.1** | **设计 Command 管理机制** | 在 `MainWindowViewModel` 或独立 Module 中定义命令 | 调试确认 Command 对象初始化 | ⚪ 计划中 |
| **2.2** | **迁移文件操作命令** | 复制、粘贴、删除逻辑绑定到 VM 命令 | 快捷键/菜单功能正常且 UI 同步 | ⚪ 计划中 |

---

## 五、总结与展望

**YiboFile** v1.0.270 是一个里程碑式的“修正”版本。我们不仅修复了 MVVM 迁移中产生的绑定崩溃，更重要的是，通过统一双栏面板的交互逻辑，消除了长期以来副面板作为“二等公民”的体验落差。虽然底层代码仍有优化空间，但用户端的体验一致性已得到根本保障。
