# YiboFile 项目评估与行动计划

> **版本**: v1.0.230 | **更新日期**: 2026-01-31

---

## 一、项目评估

### 1.1 总体评价

**YiboFile** 是一个功能丰富的现代文件管理器，重构 Windows 文件资源管理器的核心体验。本项目目前正处于从传统架构向 **MVVM 架构** 迁移的关键阵痛期。

| 维度 | 评价 |
|------|------|
| ✅ **功能** | 多标签、双栏窗口、标签系统、全文搜索等高级功能 |
| ✅ **UI** | 完整的主题/皮肤系统（目前已实现滚动条和标签美化补丁） |
| ✅ **服务层** | 划分细致，业务逻辑封装意识强 |
| ⚠️ **架构** | 正在稳步实施 MVVM。由于导航重构过于复杂，已采取“撤销并分步重构”策略 |
| ⚠️ **技术债** | `MainWindow` 依然是上帝类，代码膨胀严重 |

### 1.2 核心问题

| 问题 | 描述 | 状态 |
|------|------|------|
| ** God Class** | `MainWindow` 逻辑重度耦合 | � 改善中 |
| **导航稳定性** | 之前的重构出现死循环，已回滚到 v1.0.190 | ✅ 已修复 |
| **混合职责** | UI 与业务交互正在逐步分离 | 🟡 进行中 |

---

## 二、已完成工作 (稳定版)

### 2.1 UI 补丁与细节美化 ✅
- [x] **现代滚动条**: 在 `AppStyles.xaml` 中实现简洁窄化滚动条。
- [x] **标签视觉优化**: 标签列表改为方框容器样式，增强识别度。
- [x] **对话框样式统一**: 采用 `BaseDialogStyle.xaml` 实现扁平化 UI。

### 2.2 服务层优化 ✅
- [x] **文档预览异常捕获**: 增强了 PDF/Office 扫描时的稳定性。
- [x] **窗口状态记忆**: 修正了双屏显示下的窗口位置记忆。
- [x] **Git 历史清理**: 完成了存储库历史的深度清理与优化，确立了以 YiboFile 为核心的提交历史。

### 2.3 核心逻辑 VM 化 (v1.0.230 突破) ✅
- [x] **导航逻辑解耦 (TabsModule)**: 标签管理逻辑（创建、切换、关闭）已从 `MainWindow.Tabs.cs` 彻底迁移至 `TabsModule`。
- [x] **文件列表同步 (SSOT)**: 解决了主副面板列表在切换/刷新时的步调不一致问题，通过 `FileListViewModel` 统一管理。
- [x] **库与收藏模块**: 逻辑已封装在 `LibraryModule` 与 `FavoritesModule` 中。

---

## 三、待解决问题

### 3.1 导航与列表重构 (已阶段性完成) ✅

**实施情况**：采用了 **SSOT (单一数据源)** + **NavigationCoordinator (导航协调器)** 模式，成功解决了主副列表同步冲突。

| 子任务 | 描述 | 状态 |
|------|------|------|
| **分步一：列表 ViewModel 化** | 使用 FileListEventHandler + PaneId 实现逻辑分离，为 VM 绑定做好了准备 | ✅ 已就绪 |
| **分步二：地址栏解耦** | 已通过 SSOT (PathTab.ActiveTab) 实现完全的地址栏与导航状态同步 | ✅ 已完成 |
| **分步三：Pane 抽象** | 引入 `PaneId` 枚举与独立委托，主副面板拥有同等且独立的导航能力 | ✅ 已完成 |
| **修复：底部信息面板** | 修正了样式资源过时导致的文本不可见，并未 SelectionHandler 重新接线 | ✅ 已修复 |

---

## 四、下一阶段行动计划 (MVVM 深度解耦)

**核心原则**：大方向拆分，小步快跑，每步必测。

### 4.1 方向一：右侧面板 (FileInfo) 解耦 ⏳ (当前重点)
将 `RightPanelControl` 及其关联逻辑从 `MainWindow` 剥离，实现数据驱动的视图更新。

| 步骤 | 任务描述 | 验证方法 (可测试性) | 状态 |
|------|----------|-------------------|------|
| **1.1** | **创建 RightPanelViewModel** | 在 `ViewModels` 目录创建类并注册 DI | 检查 DI 容器能否成功解析该 VM | ✅ 已完成 |
| **1.2** | **迁移文件信息提取逻辑** | 将元数据提取、缩略图路径获取等逻辑移入 VM | 选中文件后，VM 属性正确反映文件元数据 | ⏳ 下一步 |
| **1.3** | **迁移备注 (Notes) 处理逻辑** | 将备注的加载与保存从 `MainWindow` 迁移至 VM 或 Module | 修改并保存备注，观察文件 `.notes` 或数据库是否更新 | ⚪ 计划中 |
| **1.4** | **XAML 数据绑定实现** | 修改 `RightPanelControl.xaml` 绑定至 VM 属性 | UI 元素（文件名、大小、备注区）能够实时更新 | ⚪ 计划中 |
| **1.5** | **移除 MainWindow 后置代码** | 清理 `MainWindow` 中所有操作 `RightPanel` 的 legacy 代码 | 编译通过且右侧面板功能完整（无 UI 手动赋值） | ⚪ 计划中 |

---

### 4.2 方向二：全局命令 (Commands) 与菜单重构 🟡
将硬编码的菜单事件迁移为标准 XAML Commands。

| 步骤 | 任务描述 | 验证方法 (可测试性) | 状态 |
|------|----------|-------------------|------|
| **2.1** | **设计 Command 管理机制** | 在 `MainWindowViewModel` 或独立 Module 中定义核心命令 | 调试确认 Command 对象已正确初始化 | ⚪ 计划中 |
| **2.2** | **迁移文件操作命令** | 复制、粘贴、删除逻辑绑定到 VM 命令 | 点击菜单或按快捷键，功能执行正常且 UI 同步 | ⚪ 计划中 |
| **2.3** | **视图切换逻辑重构** | 这里的“双栏模式”、“紧凑模式”切换通过命令实现 | 切换视图后，UI 状态与 VM 属性保持一致 | ⚪ 计划中 |

---

### 4.3 方向三：设置系统 (Settings) MVVM 化 ⚪
废除手动 UI 赋值，实现配置项与 UI 的双向绑定。

| 步骤 | 任务描述 | 验证方法 (可测试性) | 状态 |
|------|----------|-------------------|------|
| **3.1** | **建立 SettingsViewModel** | 封装 `ConfigManager` 的属性为 VM 可观察属性 | 修改 VM 属性，配置文件内容同步更新 | ⚪ 计划中 |
| **3.2** | **设置面板 XAML 绑定** | 直接将 `SettingsOverlay` 中的控件绑定到 VM | 在设置界面修改选项，即时改变程序行为（如主题） | ⚪ 计划中 |

---

## 五、总结与展望

**YiboFile** 已跨越了最困难的导航架构调整期。接下来的工作将进入**模块化治理**阶段。通过上述“分而治之”的策略，我们将确保每次更新都是稳定且可验证的。
