# YiboFile 项目评估与行动计划

> **版本**: v1.0.200 | **更新日期**: 2026-01-29

---

## 一、项目评估

### 1.1 总体评价

**YiboFile** 是一个功能丰富的现代文件管理器，重构 Windows 文件资源管理器的核心体验。本项目目前正处于从传统架构向 **MVVM 架构** 迁移的关键阵痛期。

| 维度 | 评价 |
|------|------|
| ✅ **功能** | 多标签、双栏窗口、标签系统、全文搜索等高级功能 |
| ✅ **UI** | 完整的主题/皮肤系统（目前已实现滚动条和标签美化补丁） |
| ✅ **服务层** | 划分细致，业务逻辑封装意识强 |
| ⚠️ **架构** | 正在稳步实施 MVVM。由于导航重构过于复杂，已采取“撤销并分步重构”策略 |
| ⚠️ **技术债** | `MainWindow` 依然是上帝类，代码膨胀严重 |

### 1.2 核心问题

| 问题 | 描述 | 状态 |
|------|------|------|
| ** God Class** | `MainWindow` 逻辑重度耦合 | � 改善中 |
| **导航稳定性** | 之前的重构出现死循环，已回滚到 v1.0.190 | ✅ 已修复 |
| **混合职责** | UI 与业务交互正在逐步分离 | 🟡 进行中 |

---

## 二、已完成工作 (稳定版)

### 2.1 UI 补丁与细节美化 ✅
- [x] **现代滚动条**: 在 `AppStyles.xaml` 中实现简洁窄化滚动条。
- [x] **标签视觉优化**: 标签列表改为方框容器样式，增强识别度。
- [x] **对话框样式统一**: 采用 `BaseDialogStyle.xaml` 实现扁平化 UI。

### 2.2 服务层优化 ✅
- [x] **文档预览异常捕获**: 增强了 PDF/Office 扫描时的稳定性。
- [x] **窗口状态记忆**: 修正了双屏显示下的窗口位置记忆。

---

## 三、待解决问题

### 3.1 导航与列表重构 (已阶段性完成) ✅

**实施情况**：采用了 **SSOT (单一数据源)** + **NavigationCoordinator (导航协调器)** 模式，成功解决了主副列表同步冲突。

| 子任务 | 描述 | 状态 |
|------|------|------|
| **分步一：列表 ViewModel 化** | 使用 FileListEventHandler + PaneId 实现逻辑分离，为 VM 绑定做好了准备 | ✅ 已就绪 |
| **分步二：地址栏解耦** | 已通过 SSOT (PathTab.ActiveTab) 实现完全的地址栏与导航状态同步 | ✅ 已完成 |
| **分步三：Pane 抽象** | 引入 `PaneId` 枚举与独立委托，主副面板拥有同等且独立的导航能力 | ✅ 已完成 |

---

## 四、下一阶段行动计划 (MVVM 解耦攻坚)

**目标**：彻底移除 `MainWindow.Handlers.cs` 和 `MainWindow.Navigation.cs` 中的业务逻辑，实现真正的 MVVM 数据绑定。

| 优先级 | 任务 | 描述 | 状态 |
|--------|------|------|------|
| **P0** | **数据绑定 (FileListViewModel)** | 将 `FileBrowser.FilesItemsSource` 绑定到 `FileListViewModel.Files`，废除代码后置手动赋值 | ⏳ 待开始 |
| **P1** | **加载逻辑迁移 (LoadFiles)** | 将 `LoadFilesAsync` 从 `MainWindow` 迁移到 `FileListViewModel`，利用 `LoadingState` 控制 UI | ⏳ 待开始 |
| **P1** | **库逻辑迁移 (LibraryViewModel)** | 将 `LoadLibraryFiles` 逻辑迁移至 `LibraryViewModel`，实现主副面板复用 | ⏳ 待开始 |
| **P2** | **右侧面板解耦 (FileInfo)** | 将 `RightPanelControl` 绑定到独立 VM，移除主窗口中的更新代码 | ⚪ 暂停中 |
| **P3** | **菜单逻辑清理** | 将 Command 绑定到 VM，移除 `MainWindow.MenuEvents.cs` | ⚪ 暂停中 |

---

## 五、总结

**YiboFile** 导航系统重构已完成，**SSOT + Coordinator** 架构表现稳定，双面板问题已解决。现在是时候由于 “核心稳定性” 问题解决，转向 **架构现代化 (MVVM)**，这是 v1.1.0 版本的核心目标。
