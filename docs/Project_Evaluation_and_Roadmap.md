# YiboFile é¡¹ç›®è¯„ä¼°ä¸è¡ŒåŠ¨è®¡åˆ’

> **ç‰ˆæœ¬**: v1.0.13 | **æ›´æ–°æ—¥æœŸ**: 2026-01-25

---

## ä¸€ã€é¡¹ç›®è¯„ä¼°

### 1.1 æ€»ä½“è¯„ä»·

**YiboFile** æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„ç°ä»£æ–‡ä»¶ç®¡ç†å™¨ï¼Œé‡æ„ Windows æ–‡ä»¶èµ„æºç®¡ç†å™¨çš„æ ¸å¿ƒä½“éªŒã€‚

| ç»´åº¦ | è¯„ä»· |
|------|------|
| âœ… **åŠŸèƒ½** | å¤šæ ‡ç­¾ã€åŒæ çª—å£ã€æ ‡ç­¾ç³»ç»Ÿã€å…¨æ–‡æœç´¢ç­‰é«˜çº§åŠŸèƒ½ |
| âœ… **UI** | å®Œæ•´çš„ä¸»é¢˜/çš®è‚¤ç³»ç»Ÿï¼ˆåŸºäº `DynamicResource`ï¼‰ |
| âœ… **æœåŠ¡å±‚** | åˆ’åˆ†ç»†è‡´ï¼Œä¸šåŠ¡é€»è¾‘å°è£…æ„è¯†å¼º |
| âš ï¸ **æ¶æ„** | ä¼ ç»Ÿ WinForm ä¸ç°ä»£ WPF æ€æƒ³çš„æ··åˆä½“ |
| âš ï¸ **æŠ€æœ¯å€º** | `MainWindow` è¿‡äºåºå¤§ï¼ŒUI ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆ |

### 1.2 æ ¸å¿ƒé—®é¢˜

| é—®é¢˜ | æè¿° | çŠ¶æ€ |
|------|------|------|
| **God Class** | `MainWindow` 20+ partial classï¼Œ~280KB ä»£ç  | ğŸ”´ ä¸¥é‡ |
| **æ··åˆèŒè´£** | UI æ§ä»¶ç›´æ¥è®¿é—®æ•°æ®åº“ | âœ… å·²ä¿®å¤ |
| **ç¡¬ç¼–ç  UI** | å³é”®èœå•é€šè¿‡ C# ä»£ç æ„å»º | âœ… å·²ä¿®å¤ |

---

## äºŒã€å·²å®Œæˆå·¥ä½œ

### 2.1 é˜¶æ®µä¸€ï¼šä»£ç æ¸…ç† âœ…

- [x] UI å±‚æ•°æ®åº“è§£è€¦ï¼ˆ`FileBrowserControl` æ”¹ç”¨ `FavoriteService`ï¼‰
- [x] å³é”®èœå•é‡æ„ï¼ˆåˆ›å»º `ContextMenuBuilder`ï¼‰
- [x] å¯¹è¯æ¡†æ ·å¼ç»Ÿä¸€ï¼ˆç»§æ‰¿ `BaseDialogStyle.xaml`ï¼‰

### 2.2 é˜¶æ®µäºŒï¼šMVVM æ¶æ„ (v1.0.13) âœ…

#### Mediator æ¶ˆæ¯é©±åŠ¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              IMessageBus                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  NavigationModule  TabsModule  FileListModule
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           MainWindowViewModel           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ç»„ä»¶ | æ–‡ä»¶ |
|------|------|
| æ¶ˆæ¯æ€»çº¿ | `IMessageBus.cs`, `MessageBus.cs` |
| æ¶ˆæ¯ç±»å‹ | `NavigationMessages.cs`, `TabMessages.cs`, `FileListMessages.cs`, `SearchMessages.cs`, `LibraryMessages.cs` |
| æ¨¡å—æ¡†æ¶ | `IModule.cs`, `ModuleBase.cs`, `MainWindowViewModel.cs` |
| æ ¸å¿ƒæ¨¡å— | `NavigationModule.cs`, `TabsModule.cs`, `FileListModule.cs` |

#### åºŸå¼ƒä»£ç æ¸…ç†

- [x] åˆ é™¤ `NavigationViewModel.cs`ï¼ˆä¸ NavigationModule é‡å¤ï¼‰
- [x] åˆ é™¤ `LibraryViewModel.cs`ï¼ˆæœªä½¿ç”¨ï¼‰
- [x] åˆ é™¤ `SearchResultGroupViewModel.cs`ï¼ˆæœªä½¿ç”¨ï¼‰

---

## ä¸‰ã€å¾…è§£å†³é—®é¢˜

### 3.1 MainWindow ä¸Šå¸ç±» ğŸ”´

**å½“å‰çŠ¶æ€**ï¼šMVVM æ¨¡å—å·²åˆ›å»ºï¼Œä½† partial class é€»è¾‘**ä»…æ¡¥æ¥è°ƒç”¨**ï¼Œå°šæœªçœŸæ­£è¿ç§»ã€‚

| æ–‡ä»¶ | å¤§å° | è¿ç§»ç›®æ ‡ |
|------|------|----------|
| `MainWindow.xaml.cs` | 41.8 KB | ä¸»åè°ƒè€… |
| `MainWindow.LayoutMode.cs` | 37.2 KB | LayoutModule |
| `MainWindow.Handlers.cs` | 34.0 KB | å„ Module |
| `MainWindow.Navigation.cs` | 30.3 KB | NavigationModule |
| `MainWindow.Tabs.cs` | 10.9 KB | TabsModule |
| **å…¶ä»– 15 ä¸ªæ–‡ä»¶** | ~125 KB | -- |
| **æ€»è®¡** | **~280 KB** | -- |

### 3.2 å…¶ä»–å¤§æ–‡ä»¶ ğŸŸ¡

| æ–‡ä»¶ | å¤§å° | å»ºè®® |
|------|------|------|
| `DocumentPreview.cs` | 88.9 KB | æŒ‰æ–‡æ¡£ç±»å‹æ‹†åˆ† |
| `TabService.cs` | 62.9 KB | åˆ†ç¦» UI/ä¸šåŠ¡é€»è¾‘ |
| `DatabaseManager.cs` | 60.5 KB | æ‹†åˆ†ä¸ºå¤šä¸ª Repository |
| `SettingsViewModel.cs` | 50.6 KB | æŒ‰è®¾ç½®ç±»åˆ«æ‹†åˆ† |

---

## å››ã€è¡ŒåŠ¨è®¡åˆ’

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | å·¥ä½œé‡ | çŠ¶æ€ |
|--------|------|--------|------|
| **P1** | è¿ç§» `MainWindow.Navigation.cs` (Loading Logic) | 1å¤© | âœ… å·²å®Œæˆ |
| **P1** | è¿ç§» `MainWindow.Navigation.cs` (Tab Selection) | 1-2å¤© | âœ… å·²å®Œæˆ |
| **P1** | è¿ç§» `MainWindow.Tabs.cs` â†’ `TabsModule` | 2-3å¤© | âœ… å·²å®Œæˆ |
| **P2** | æ‹†åˆ† `DocumentPreview.cs` | 1å¤© | âœ… å·²å®Œæˆ |
| **P2** | æ‹†åˆ† `TabService.cs` | 1-2å¤© | âœ… å·²å®Œæˆ |
| **P3** | æ‹†åˆ† `SettingsViewModel.cs` | 1å¤© | å¾…å¼€å§‹ |
| **P3** | æ‹†åˆ† `DatabaseManager.cs` | 2å¤© | å¾…å¼€å§‹ |

---

## äº”ã€æ€»ç»“

**YiboFile** æœåŠ¡å±‚æ¶æ„è‰¯å¥½ï¼ŒMVVM æ¶ˆæ¯é©±åŠ¨åŸºç¡€è®¾æ–½å·²å°±ç»ªã€‚ä¸‹ä¸€æ­¥é‡ç‚¹æ˜¯å°† `MainWindow` partial class ä¸­çš„é€»è¾‘çœŸæ­£è¿ç§»åˆ°å¯¹åº” Moduleï¼Œå®ç°å®Œå…¨è§£è€¦ã€‚
